<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE niftoolsxml>
<niftoolsxml version="0.7.1.0">

	<xi:include href="../ovl_base/ovl_base.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(*/*)" />

	<!-- Structs for the OVL file -->

    <compound name="Header" inherit="GenericHeader">
        Found at the beginning of every OVL file

        <add name="info" type="VoxelskirtRoot"/>

    </compound>

    <compound name="VoxelskirtRoot" inherit="MemStruct">
        # size varies according to game
        JWE2 - 120 bytes
        <add name="zero" type="uint64"/>
        <add name="data size" type="uint64" >total size of buffer data</add>
        <add name="x" type="uint64"/>
        <add name="y" type="uint64"/>
        <add name="scale" type="float"/>
        <add name="padding" type="float"/>
        <add name="zero pc" type="uint64" vercond="#PC#">zero, for PC only</add>
        <add name="height array size pc" type="uint64" vercond="#PC#" >x*y*4, for PC only</add>
        <add name="datas" type="DataSlot" vercond="!#PC#" template="Data" >entries of 32 bytes</add>
        <add name="sizes" type="DataSlot" vercond="!#PC#" template="Size" >entries of 40 bytes</add>
        <add name="positions" type="DataSlot" >counts the -1 structs; entries of 32 bytes</add>
        <add name="materials" type="DataSlot" template="Material"/>
        <add name="names" type="DataSlot" template="Name"/>
    </compound>

    <compound name="DataSlot">
        offset into buffer to start of sth; only given if some count is nonzero
        <add name="offset" type="uint64" >offset into buffer to start</add>
        <add name="count" type="uint64" >also counts the stuff after names</add>
    </compound>

    <compound name="Name">
        <add name="offset" type="uint64" >address of this data layer</add>
    </compound>

    <compound name="Data">
        PZ and JWE only, describes a data layer image
        <add name="id" type="uint64" >index into name list</add>
        <add name="dtype" type="uint64" >0 = ubyte, 2 = float</add>
        <add name="offset" type="uint64" >address of this data layer</add>
        <add name="dsize" type="uint64" >data size of this layer, in bytes</add>
    </compound>

    <compound name="Size">
        <add name="id" type="uint64" >index into name list</add>
        <add name="width 1" type="uint64" ></add>
        <add name="height 1" type="uint64" ></add>
        <add name="width 2" type="uint64" ></add>
        <add name="height 2" type="uint64" ></add>
    </compound>

    <compound name="Material">
        <add name="offset" type="uint64" >address of child data</add>
        <add name="count" type="uint64" >repeat count of child structs (4 floats)</add>
        <add name="id" type="uint64" >index into name list</add>
    </compound>

    <compound name="PosInfo" inherit="Material">
        <add name="ff" type="int" >-1</add>
        <add name="ff or zero" type="int" >-1, 0 for PC</add>
    </compound>


</niftoolsxml>
